Sonet.am.scorm.PISA2025.TransportPod = {
   world310:
      [
         ["E", "E", "E"],
         ["E", "F", "E"],
         ["E", "L", "E"],
         ["E", "L", "E"],
         ["E", "L", "E"],
         ["E", "L", "E"],
         ["E", "L", "E"],
         ["E", "L", "E"],
         ["E", "L:P", "E"],
         ["E", "S", "E"],
         ["E", "E", "E"]
      ],
   world316:
      [["E", "E", "E"],
      ["E", "F", "E"],
      ["E", "L:P", "E"],
      ["E", "L", "E"],
      ["E", "L", "E"],
      ["E", "L", "E"],
      ["E", "L", "E"],
      ["E", "L", "E"],
      ["E", "L", "E"],
      ["E", "S", "E"],
      ["E", "E", "E"]],

   world316h2:
      [["E", "E", "E"],
      ["E", "S", "E"],
      ["E", "L:P", "E"],
      ["E", "L", "E"],
      ["E", "L", "E"],
      ["E", "E", "E"]],

   world317:
      [["E", "E", "E"],
      ["E", "F", "E"],
      ["E", "L", "E"],
      ["E", "L", "E"],
      ["E", "L", "E"],
      ["E", "L", "E"],
      ["E", "L", "E"],
      ["E", "L", "E"],
      ["E", "L:P", "E"],
      ["E", "S", "E"],
      ["E", "E", "E"]],

   world317h2: [
      ["E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "L", "L", "L", "L", "E", "E", "E", "E", "E"],
      ["E", "E", "E", "L", "E", "E", "E", "E", "L", "E", "E", "E", "E"],
      ["E", "E", "L", "E", "E", "E", "E", "E", "E", "L", "E", "E", "E"],
      ["E", "L:P", "E", "E", "E", "E", "E", "E", "E", "E", "S", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E"],
   ],

   world318: [
      ["E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "F", "E", "E", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "L", "E", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "L", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "E", "L", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "E", "E", "L", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "L", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "E", "E", "L", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "E", "L", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "L", "E", "E", "E", "E"],
      ["E", "S", "L:P", "L", "L", "L", "L", "E", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E"],
   ],

   world319: [
      ["E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "S", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "E", "E", "L", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "E", "L", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "L", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "L", "E", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "L", "E", "E", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "L", "E", "E", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "L", "E", "E", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "L", "E", "E", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "L", "E", "E", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "L", "E", "E", "E", "E", "E", "E", "E"],
      ["E", "E", "E", "L", "E", "E", "E", "E", "E", "E", "E", "E"],
      ["E", "E", "L", "E", "E", "E", "E", "E", "E", "E", "E", "E"],
      ["E", "L", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E"],
      ["E", "L", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E"],
      ["E", "L", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E"],
      ["E", "L", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E"],
      ["E", "L:P", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E"]
   ],

   world323: [
      ["E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E"],
      ["E", "F", "E", "E", "E", "E", "E", "F", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E"],
      ["E", "E", "L", "E", "E", "E", "L", "E", "E", "E", "E", "E", "E", "F", "E", "E", "E", "E", "E", "F", "E"],
      ["E", "E", "E", "L", "E", "L", "E", "E", "E", "E", "E", "E", "E", "E", "L", "E", "E", "E", "L", "E", "E"],
      ["E", "E", "E", "E", "L", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "L", "E", "L", "E", "E", "E"],
      ["E", "E", "E", "E", "L", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "L", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "L", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "L", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "L", "E", "E", "E", "E", "E", "L", "E", "E", "E", "E", "E", "L", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "L", "E", "E", "E", "L", "E", "L", "E", "E", "E", "L", "E", "L", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "L", "E", "L", "E", "E", "E", "L", "E", "L", "E", "E", "E", "L", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "L", "E", "E", "E", "E", "E", "L", "E", "E", "E", "E", "E", "F", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "L", "E", "E", "E", "E", "E", "L", "E", "E", "E", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "L", "E", "E", "E", "E", "E", "L", "E", "E", "E", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "L:P", "E", "E", "E", "E", "E", "F", "E", "E", "E", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "S", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E"],
      ["E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E"]
   ],
   map310: {
      "path": "M 293 431  l 0 -372",
      "pod": [170, 223],
      "rect": [273, 430],
      "circle": [[293, 45]],
   },

   map316: {
      "path": "M 200 375 l 0 -300",
      "pod": [170, 80],
      "rect": [185, 365],
      "circle": [[200, 80]],
   },

   map316h2: {
      "path": "M 200 375 l 0 -300",
      "pod": [170, 80],
      "rect": [185, 70],
      "circle": [],
   },

   map317: {
      "path": "M 200 375 l 0 -300",
      "pod": [170, 320],
      "rect": [185, 365],
      "circle": [[200, 80]],
   },

   map317h2: {
      "path": "M 120 220 l -32 -60 50 -100 110 0 50 85",
      "pod": [60, 120],
      "rect": [255, -200, 60],
      "circle": [[120, 220]],
   },

   map318: {
      "path": "M 110 318 l 165 0 l 61 -102 l -78 -130",
      "pod": [125, 288],
      "rect": [110, 302],
      "circle": [[258, 85]],
   },

   map319: {
      "path": " M 100 380 l 0 -120 l 86 -47 l 0 -105 l 95 -52",
      "pod": [70, 330],
      "rect": [172, -240, 60],
      "circle": [],
   },

   map323: {
      "path": " M 190 400 l 0 -130 l -78 -43 l 0 -92 l -78 -43" +
         " M 115 135 l 78 -43" +
         " M 190 270 l 78 -43 l 78 43 l 78 -43 l 78 43" +
         " M 347 365 l 0 -100" +
         " M 425 225 l 0 -60 l -78 -43" +
         " M 425 165 l 78 -43",
      "pod": [161, 330],
      "rect": [175, 375],
      "circle": [[35, 90], [190, 90], [345, 120], [503, 120], [503, 270], [347, 360]],
   },

   mapHelp: {
      "path": " M 310 318 l 78 -130 l -78 -130 l -170 -0 l -78 130 l 78 13",
      "pod": [201, 330],
      "rect": [215, 375],
      "circle": [[75, 90]],
   },

   init: function (parent) {
      let me = this;
      this.parent = parent;
      if ($('#task').hasClass('p1-check-correct')) {
         $('#task').on('checkFinish', function (e) {
            if (!me.parent.isModalShowing('.g-success-dialog') && !me.parent.isModalShowing('.g-retry-dialog')) {
               e.dialog[0] = 'g-retry-dialog';
            }
         });
      }
      if ($("#task").attr("data-itemid") !== "P1M310") {
         $(".tab-info").click(function () {
            Sonet.Util.showModal('g-info-dialog');
         });
      }
   },
   P1M304: function () {
      new Sonet.am.widgets.RoboArmBlocklyPlugin({
         workspaceSettings: {
            readOnly: true
         },
         workspaceData:
            `<xml xmlns="http://www.w3.org/1999/xhtml">
            <block type="block_start" deletable="false" movable="false" x="20" y="20"><next>
            <block type="tp_repeat_image"><field name="SHAPE">BOX</field>
            <statement name="DO"><block type="tp_repeat_image"><field name="SHAPE">INTS</field>
            <statement name="DO"><block type="transportpod_move_pod"></block></statement><next><block type="transportpod_turn_right"><next>
             <block type="block_end">
            </block></next></block></next></block>
            </statement></block></next></block>
         </xml>
         `
      });
   },
   P1M305: function () {
      new Sonet.am.widgets.RoboArmBlocklyPlugin({
         workspaceData:
            `<xml xmlns="http://www.w3.org/1999/xhtml">
            <block type="when_run" deletable="false" x="20" y="20" movable="false"><next>
            <block type="repeat_plain" movable="false">
            <statement name="DO"><block type="tp_move_option" movable="false"><field name="VALUE"></field><next><block type="tp_if_do_one_option" movable="false"><field name="SENSOR"></field>
            <statement name="DO"><block type="tp_turn_plain" movable="false"></block></statement></block></next></block></statement></block></next></block>
         </xml>
         `
      });

   },

   P1M306: function () {
      new Sonet.am.widgets.RoboArmBlocklyPlugin({
         workspaceSettings: {
            readOnly: true
         },
         workspaceData:
            `<xml xmlns="http://www.w3.org/1999/xhtml">
            <block type="block_start" deletable="false" movable="false" x="20" y="20"><next>
            <block type="repeat_do"><field name="TIMES">2</field><statement name="DO"><block type="move_down"><next>
            <block type="repeat_do"><field name="TIMES">2</field><statement name="DO"><block type="move_left"></block></statement>
            </block></next></block></statement><next>
            <block type="move_down"><next><block type="block_end">
            </block></next>
            </block></next></block>
            </next></block>
         </xml>`
      });
   },
   P1M307: function () {
      new Sonet.am.widgets.RoboArmBlocklyPlugin({
         workspaceSettings: {
            readOnly: true
         },
         workspaceData:
            `<xml xmlns="http://www.w3.org/1999/xhtml">
            <block type="block_start" x="10" y="10">
               <next><block type="repeat_do">
                  <field name="TIMES">3</field>
                  <statement name="DO">
                     <block type="if_option_text_color">
                     <statement name="DO"><block type="move_down"></block></statement>
                     <next><block type="move_right"></block></next></block>
                  </statement>
            <next><block type="block_end">
            </block></next></block></next>
            </block>
         </xml>`
      });

      $('.g-grid-container-selectable').on('click', '.selection-box', function (e) {
         $(this).parent().find('.g-grid-block-sel').removeClass('g-grid-block-sel');
         $(this).addClass('g-grid-block-sel');
         $(this).parent().find('.g-grid-response').val($(this).index() + 1);
      });

   },
   P1M307_loadResults: function () {
      scormApi = Sonet.am.scorm.ScormWrapper;

      // set the selected state from the save data. We dont need to set the input value as this will be handled
      // by the likert class. However we dont know the execution order so we retrieve the value from the API not the input field
      $('.g-grid-container-selectable').each(function () {
         let input = $(this).find('.g-grid-response');
         if (input.attr('id') != null) {
            let val = scormApi.getInteraction(input.attr('id'), true);
            if (val != null && val != '') {
               $(this).find('.selection-box:nth-child(' + val + ')').addClass('g-grid-block-sel');
            }
         }
      });

   },
   P1M309: function () {

      let me = this, actionRequiredList = [];

      Sonet.Util.showModal('p1-m3-09-intro-dialog');

      let tutorialConfig = me.parent.setTutorialConfig(
         "tutorial-text",
      );

      me.renderTutorialMainWindow(0);

      $("#start-first-tutorial").click(() => {
         me.renderTutorialMainWindow(1);
         me.renderTutorialWindow(
            "p1-m3-09-tutorial-window",
            tutorialConfig,
            actionRequiredList
         );
      });
      $("body").on("click", ".g-tutorial-window-next-button", () => {
         page = $('.g-tutorial-window-content').attr('data-current-page');
         //check current tutorial window
         switch (page) {
            case "1":
               this.renderTutorialMainWindow(2);
               me.switchTutorial("2");
               break;
            case "2":
               this.renderTutorialMainWindow(3);
               me.switchTutorial("3");
               break;
            case "3":
               this.renderTutorialMainWindow(4);
               me.switchTutorial("4");
               break;
            case "4":
               this.renderTutorialMainWindow("finish");
               me.switchTutorial("finish");
               break;
         }
      });
      $("body").on("click", "#click-sensor", () => {
         this.renderTutorialMainWindow("finish");
         me.switchTutorial("finish");
      })
      $("body").on("click", ".g-tutorial-window-back-button", () => {
         page = $('.g-tutorial-window-content').attr('data-current-page');
         //check current tutorial window
         switch (page) {
            case "1":
               this.renderTutorialMainWindow(0);
               Sonet.Util.showModal('p1-m3-09-intro-dialog');
               $("#p1-m3-09-tutorial-window").children().remove();
               break;
            case "2":
               this.renderTutorialMainWindow(1);
               me.switchTutorial("1");
               break;
            case "3":
               this.renderTutorialMainWindow(2);
               me.switchTutorial("2");
               break;
            case "4":
               this.renderTutorialMainWindow(3);
               me.switchTutorial("3");
               break;
            case "finish":
               this.renderTutorialMainWindow(4);
               $("#p1-m3-09-tutorial-main-window .p1-m3-pod-img").children().first().remove();
               Sonet.Util.hideModal('g-tutorial-finished');
               this.renderTutorialWindow(
                  "p1-m3-09-tutorial-window",
                  tutorialConfig,
                  actionRequiredList)
               me.switchTutorial("4");
               break;
            default:
               break;
         }
      });
   },
   P1M310: function () {
      let me = this, actionRequiredList = [];
      Sonet.Util.showModal('p1-m3-10-intro-dialog');
      let tutorialConfig = me.parent.setTutorialConfig(
         "tutorial-text",
      );
      config = {
         worlds: [{
            worldID: '#tp-world1',
            state: $.extend(true, [], this.world310),
            map: this.map310,
         }],
         tpConfig: {
            toolboxData: this.getToolbox('basic'),
            workspaceSettings: {
               trashcan: true,
               scrollbars: false
            },
            workspaceData: `<xml xmlns="http://www.w3.org/1999/xhtml">
            <block type="when_run" x="20" y="20" movable="false"></block>
         </xml>`
         }
      }
      $("#p1-m3-info").css("display", "none");
      $(".tab-info").click(function () {
         $(".tab-info").removeClass("g-blockly-tab-inactive").addClass("g-blockly-tab-active");
         $(".tab-sim").removeClass("g-blockly-tab-active").addClass("g-blockly-tab-inactive");
         $(".tab-simulation").css("display", "none");
         $("#p1-m3-info").css("display", "block");
         $(".tab-nature-pod").click();
      });

      $("body").on('click', '.tab-nature-pod', function () {
         $(".tab-nature-pod").removeClass("p1-m3-info-inactive").addClass("p1-m3-info-active");
         $(".tab-nature-key").removeClass("p1-m3-info-active").addClass("p1-m3-info-inactive");
         let informationPage = `<div class="g-flex-center-row g-full-height">
         <div class="p1-m3-pod-img border relative">
            <p class="text-18 mt-0 text-bold-7">Side view</p>
            <div class="flex mt-90 flex-column align-center">
               <p class="m-0 absolute text-red text-16 text-bold-5 text-side-front">front of nature pod</p>
               <p class="m-0 absolute text-red text-16 text-bold-5 text-side-back">back of nature pod</p>
               <p class="m-0 absolute text-16 text-bold-5 text-side-sensor">colour sensor</p>
               <div class="angle-anti-67 length-65 absolute arrow-side-sensor"><span class="arrow"></span></div>
               <p class="m-0 absolute text-16 text-bold-5 text-side-wheel">wheel</p>
               <div class="angle-anti-124 length-80 absolute arrow-side-wheel"><span class="arrow"></span></div>
               <img class="mr-20" src="images/pod-side-note.png" width="130px" height="68px"/>
            </div>
         </div>
         <div class="p1-m3-pod-img border relative">
            <p class="text-18 mt-0 text-bold-7">Top-down view</p>
            <p class="text-red text-18 text-center text-bold-5">front of nature pod</p>
            <div class="text-center w-full right-image">
               <p class="m-0 absolute text-16 text-bold-5 text-middle-sensor">middle colour sensor</p>
               <p class="m-0 absolute text-16 text-bold-5 text-left-sensor">left colour sensor</p>
               <p class="m-0 absolute text-16 text-bold-5 text-right-sensor">right colour sensor</p>
               <p class="m-0 absolute text-16 text-bold-5 text-left-wheel">left wheel</p>
               <p class="m-0 absolute text-16 text-bold-5 text-right-wheel">right wheel</p>
               <div class="angle-90 length-44 absolute arrow-middle-sensor"><span class="arrow"></span></div>
               <div class="angle-58 length-34 absolute arrow-left-sensor"><span class="arrow"></span></div>
               <div class="angle-120 length-34 absolute arrow-right-sensor"><span class="arrow"></span></div>
               <div class="angle-anti-45 length-60 absolute arrow-left-wheel"><span class="arrow"></span></div>
               <div class="angle-anti-141 length-65 absolute arrow-right-wheel"><span class="arrow"></span></div>
               <img src="images/pod-top-note.png" width="166px" height="119px"/>
            </div>
            <p class="text-red text-18 text-center text-bold-5">back of Nature Pod</p>
         </div>
      </div>`;
         $(".p1-m3-info-body").html(informationPage);
      })

      $("body").on('click', '.tab-nature-key', function () {
         $(".tab-nature-key").removeClass("p1-m3-info-inactive").addClass("p1-m3-info-active");
         $(".tab-nature-pod").removeClass("p1-m3-info-active").addClass("p1-m3-info-inactive");
         let informationPage = `<table class="key-table"><tr><td><img src="images/objL.png" /></td>
            <td>Track</td></tr>
         <tr><td><img src="images/objJ.png" /></td>
            <td>Track junction</td></tr>
         <tr><td><span class="yellow-circle"></span></td><td>Viewing area</td></tr>
         <tr><td><span class="red-square"></span></td><td>Visitor kiosk</td></tr></table>`;
         $(".p1-m3-info-body").html(informationPage);
      })

      $(".tab-sim").click(function () {
         $(".tab-info").removeClass("g-blockly-tab-active").addClass("g-blockly-tab-inactive");
         $(".tab-sim").removeClass("g-blockly-tab-inactive").addClass("g-blockly-tab-active");
         $("#p1-m3-info").css("display", "none");
         $(".tab-content").css("display", "block");
      })
      $("body").on("click", ".g-tutorial-window-next-button", () => {

         page = $('.g-tutorial-window-content').attr('data-current-page');
         //check current tutorial window
         switch (page) {
            case "1":
               me.switchTutorial("2");
               config.tp.resetWorkspace(`<xml xxmlns="http://www.w3.org/1999/xhtml">
               <block type="when_run" deletable="false" movable="false" x="20" y="20"><next><block type="transportpod_move_pod"></block></next></block>
             </xml>`);
               $("#background-cover").removeClass("cover-right").addClass("cover-left");
               break;
            case "2":
               $("#background-cover").removeClass("cover-left").addClass("cover-right");
               me.switchTutorial("3");
               break;
            case "3":
               config.tp.resetWorkspace(`<xml xmlns="http://www.w3.org/1999/xhtml">
                     <block type="when_run" x="20" y="20" movable="false"></block>
                  </xml>`);
               me.switchTutorial("4");
               break;
            case "4":
               config.tp.resetWorkspace(`<xml xxmlns="http://www.w3.org/1999/xhtml">
               <block type="when_run" deletable="false" movable="false" x="20" y="20"><next>
               <block type="tp_repeat_option"><field name="REPEAT"></field>
               <field name="SENSOR"></field><field name="SHAPE"></field><statement name="DO"></statement></block></next></block>
            </xml>`);
               me.switchTutorial("5");
               break;
            case "5":
               config.tp.resetWorkspace(`<xml xxmlns="http://www.w3.org/1999/xhtml">
               <block type="when_run" deletable="false" movable="false" x="20" y="20"><next>
               <block type="tp_repeat_option"><field name="REPEAT">WHILE</field>
               <field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field><statement name="DO"></statement></block></next></block>
            </xml>`);
               me.switchTutorial("6");
               break;
            case "6":
               $("#background-cover").removeClass("cover-right").addClass("cover-left");
               config.tp.resetWorkspace(`<xml xxmlns="http://www.w3.org/1999/xhtml">
               <block type="when_run" deletable="false" movable="false" x="20" y="20"><next>
               <block type="tp_repeat_option"><field name="REPEAT">WHILE</field>
               <field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field><statement name="DO"><block type="transportpod_move_pod"></block></statement></block></next></block>
            </xml>`);
               me.switchTutorial("7");
               break;
            case "7":
               me.switchTutorial("8");
               break;
            case "8":
               $("#background-cover").removeClass("cover-left");
               me.switchTutorial("finish");
               break;
         }
      });

      $("body").on("click", ".g-tutorial-window-back-button", () => {
         $(".tab-sim").click();
         page = $('.g-tutorial-window-content').attr('data-current-page');
         //check current tutorial window
         switch (page) {
            case "1":
               Sonet.Util.showModal('p1-m3-10-intro-dialog');
               $("#p1-m3-10-tutorial-window").children().remove();
               break;
            case "2":
               $("#background-cover").removeClass("cover-left").addClass("cover-right");
               config.tp.resetWorkspace(`<xml xxmlns="http://www.w3.org/1999/xhtml">
               <block type="when_run" deletable="false" movable="false" x="20" y="20"></block>
             </xml>`);
               me.switchTutorial("1");
               break;
            case "3":
               $("#background-cover").removeClass("cover-right").addClass("cover-left");
               me.switchTutorial("2");
               break;
            case "4":
               config.tp.resetWorkspace(`<xml xxmlns="http://www.w3.org/1999/xhtml">
               <block type="when_run" deletable="false" movable="false" x="20" y="20"><next><block type="transportpod_move_pod"></block></next></block>
             </xml>`);
               me.switchTutorial("3");
               break;
            case "5":
               config.tp.resetWorkspace(`<xml xmlns="http://www.w3.org/1999/xhtml">
               <block type="when_run" x="20" y="20" movable="false"></block>
            </xml>`);
               me.switchTutorial("4");
               break;
            case "6":
               config.tp.resetWorkspace(`<xml xxmlns="http://www.w3.org/1999/xhtml">
               <block type="when_run" deletable="false" movable="false" x="20" y="20"><next>
               <block type="tp_repeat_option"><field name="REPEAT"></field>
               <field name="SENSOR"></field><field name="SHAPE"></field><statement name="DO"></statement></block></next></block>
            </xml>`);
               me.switchTutorial("5");
               break;
            case "7":
               $("#background-cover").removeClass("cover-left").addClass("cover-right");
               config.tp.resetWorkspace(`<xml xxmlns="http://www.w3.org/1999/xhtml">
               <block type="when_run" deletable="false" movable="false" x="20" y="20"><next>
               <block type="tp_repeat_option"><field name="REPEAT">WHILE</field>
               <field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field><statement name="DO"></statement></block></next></block>
            </xml>`);
               me.switchTutorial("6");
               break;
            case "8":
               me.switchTutorial("7");
               break;
            case "finish":
               Sonet.Util.hideModal('g-tutorial-finished');
               this.renderTutorialWindow(
                  "p1-m3-10-tutorial-window",
                  tutorialConfig,
                  actionRequiredList)
               me.switchTutorial("8");
               $("#background-cover").addClass("cover-left");
               break;
            default:
               break;
         }
      });

      $("#start-first-tutorial").click(() => {
         // me.renderTutorialMainWindow(1);
         $("#background-cover").addClass("cover-right");
         me.renderTutorialWindow(
            "p1-m3-10-tutorial-window",
            tutorialConfig,
            actionRequiredList
         );
      });

      me.initBasicActionItems(config);
      this.helpTooltip();
   },
   P1M316: function () {
      this.initBasicActionItems({
         worlds: [{
            worldID: '#tp-world1',
            state: $.extend(true, [], this.world316),
            map: this.map316,
         }],
         tpConfig: {
            toolboxData: this.getToolbox('basic'),
            workspaceSettings: {
               trashcan: true,
               scrollbars: true
            },
            workspaceData:
               `<xml xmlns="http://www.w3.org/1999/xhtml">
                  <block type="when_run" x="20" y="20" movable="false"></block>
               </xml>`
         }
      });
      this.helpTooltip();
   },
   P1M316_P1H2: function () {

      this.initBasicActionItems({
         worlds: [{
            worldID: '#tp-world1-h2',
            state: $.extend(true, [], this.world316h2),
            map: this.map316h2,
            height: 250,
            CURRENT_HEAD_DEG: 180,
         }],
         tpConfig: {
            workspaceSettings: { readOnly: true },
            blocklyElem: 'blocklyDivH2',
            workspaceData:
               `<xml xxmlns="http://www.w3.org/1999/xhtml">
                     <block type="when_run" deletable="false" movable="false" x="20" y="20"><next>
                     <block type="tp_repeat_option"><field name="REPEAT">UNTIL</field>
                     <field name="SENSOR">MIDDLE</field><field name="SHAPE">S</field><statement name="DO">
                     <block type="transportpod_turn_left"></block></statement></block></next></block>
                  </xml>`
         }
      });

   },
   P1M316_P1H3: function () {

      this.initBasicActionItems({
         worlds: [{
            worldID: '#tp-world1-h316',
            state: $.extend(true, [], this.world316),
            map: this.map316,
         }],
         tpConfig: {
            workspaceSettings: { readOnly: true },
            blocklyElem: 'blocklyDivH316',
            workspaceData:
               `<xml xxmlns="http://www.w3.org/1999/xhtml">
                     <block type="when_run" deletable="false" movable="false" x="20" y="20"><next>
                     <block type="tp_repeat_option"><field name="REPEAT">UNTIL</field>
                     <field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field><statement name="DO">
                     <block type="transportpod_turn_left"></block></statement></block></next></block>
                  </xml>`
         }
      });

   },
   P1M317: function () {
      this.initBasicActionItems({
         worlds: [{
            worldID: '#tp-world1',
            state: $.extend(true, [], this.world317),
            map: this.map317,
         }],
         tpConfig: {
            toolboxData: this.getToolbox(['tp_wait', 'repeat_do']),
            workspaceSettings: {
               trashcan: true,
               scrollbars: true
            },
            workspaceData:
               `<xml xmlns="http://www.w3.org/1999/xhtml">
                  <block type="when_run" deletable="false" movable="false" x="20" y="20"><next>
                  <block type="tp_repeat_option"><field name="REPEAT">WHILE</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field>
                  <statement name="DO"><block type="transportpod_move_pod"></block></statement><next><block type="tp_wait"><next>
                  <block type="tp_wait"><next><block type="tp_wait"><next><block type="tp_wait"><next><block type="tp_wait"><next>
                  <block type="tp_repeat_option"><field name="REPEAT">UNTIL</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field>
                  <statement name="DO"><block type="transportpod_turn_left"></block></statement></block></next></block></next></block>
                  </next></block></next></block></next></block></next></block></next></block>
               </xml>`
         }
      });
      this.helpTooltip();
   },
   P1M317_P1H2: function () {

      this.initBasicActionItems({
         worlds: [{
            worldID: '#tp-world1-h2',
            state: $.extend(true, [], this.world317h2),
            map: this.map317h2,
            height: 250,
            cellWidth: 35,
            CURRENT_HEAD_DEG: 330,
            r_deg: 30,
         }],
         tpConfig: {
            workspaceSettings: { readOnly: true },
            blocklyElem: 'blocklyDivH2',
            workspaceData:
               `<xml xmlns="http://www.w3.org/1999/xhtml"><block type="when_run" deletable="false" movable="false" x="20" y="20"><next>
                     <block type="tp_repeat_option"><field name="REPEAT">UNTIL</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field>
                     <statement name="DO"><block type="transportpod_turn_right"></block></statement><next>
                     <block type="tp_repeat_option"><field name="REPEAT">WHILE</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field>
                     <statement name="DO"><block type="transportpod_move_pod"></block></statement><next>
                     <block type="tp_repeat_option"><field name="REPEAT">UNTIL</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field>
                     <statement name="DO"><block type="transportpod_turn_right"></block></statement><next>
                     <block type="tp_repeat_option"><field name="REPEAT">WHILE</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field>
                     <statement name="DO"><block type="transportpod_move_pod"></block></statement><next>
                     <block type="tp_repeat_option"><field name="REPEAT">UNTIL</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field>
                     <statement name="DO"><block type="transportpod_turn_right"></block></statement><next>
                     <block type="tp_repeat_option"><field name="REPEAT">WHILE</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field>
                     <statement name="DO"><block type="transportpod_move_pod"></block></statement></block></next></block></next></block></next>
                     </block></next></block></next></block></next></block>
                  </xml>`
         }
      });

      this.initBasicActionItems({
         tpConfig: {
            workspaceSettings: { readOnly: true },
            blocklyElem: 'blocklyDivH3',
            workspaceData:
               `<xml xmlns="http://www.w3.org/1999/xhtml">
                  <block type="when_run" deletable="false" movable="false" x="20" y="20"><next>
                  <block type="repeat_do"><field name="TIMES">3</field><statement name="DO">
                  <block type="tp_repeat_option"><field name="REPEAT">UNTIL</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field>
                  <statement name="DO"><block type="transportpod_turn_right"></block></statement><next>
                  <block type="tp_repeat_option"><field name="REPEAT">WHILE</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field>
                  <statement name="DO"><block type="transportpod_move_pod"></block></statement></block></next></block></statement></block></next></block>
               </xml>`
         }
      });

      //scale canvas to fit the screen
      $('#blocklyDivH2').find('.blocklyBlockCanvas').css('transform', 'scale(0.7)');
      $('#blocklyDivH3').find('.blocklyBlockCanvas').css('transform', 'scale(0.7)');

   },
   P1M317_P1H3: function () {

      this.initBasicActionItems({
         worlds: [{
            worldID: '#tp-world1-h317',
            state: $.extend(true, [], this.world317),
            map: this.map317,
         }],
         tpConfig: {
            workspaceSettings: { readOnly: true },
            blocklyElem: 'blocklyDivH317',
            workspaceData:
               `<xml xmlns="http://www.w3.org/1999/xhtml">
                     <block type="when_run" deletable="false" movable="false" x="20" y="20"><next>
                     <block type="repeat_do"><field name="TIMES">2</field><statement name="DO">
                     <block type="tp_repeat_option"><field name="REPEAT">WHILE</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field>
                     <statement name="DO"><block type="transportpod_move_pod"></block></statement><next>
                     <block type="repeat_do"><field name="TIMES">5</field><statement name="DO"><block type="tp_wait"></block></statement><next>
                     <block type="tp_repeat_option"><field name="REPEAT">UNTIL</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field><statement name="DO">
                     <block type="transportpod_turn_left"></block></statement></block></next></block></next></block></statement>
                     </block></next></block>
                  </xml>`
         }
      });

   },
   P1M318: function () {
      this.initBasicActionItems({
         worlds: [{
            worldID: '#tp-world1',
            state: $.extend(true, [], this.world318),
            map: this.map318,
            CURRENT_HEAD_DEG: 90,
            r_deg: 30,
            cellWidth: 30,
         }],
         tpConfig: {
            toolboxData: this.getToolbox('tp_if_do'),
            workspaceSettings: {
               trashcan: true,
               scrollbars: true
            },
            workspaceData:
               `<xml xmlns="http://www.w3.org/1999/xhtml">
               <block type="when_run" x="20" y="20" movable="false"></block>
            </xml>`
         }
      });
      this.helpTooltip();
   },
   P1M318_P1H2: function () {

      this.initBasicActionItems({
         worlds: [{
            worldID: '#tp-world1-h2',
            state: $.extend(true, [], this.world317h2),
            map: this.map317h2,
            height: 250,
            cellWidth: 35,
            CURRENT_HEAD_DEG: 330,
            r_deg: 30,
         }],
         tpConfig: {
            workspaceSettings: { readOnly: true },
            blocklyElem: 'blocklyDivH2',
            workspaceData:
               `<xml xmlns="http://www.w3.org/1999/xhtml">
                     <block type="when_run" deletable="false" movable="false" x="20" y="20"><next>
                     <block type="tp_repeat_option"><field name="REPEAT">UNTIL</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">S</field>
                     <statement name="DO"><block type="tp_repeat_option"><field name="REPEAT">WHILE</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field>
                     <statement name="DO"><block type="transportpod_move_pod"></block></statement><next>
                     <block type="tp_if_do"><field name="SENSOR">RIGHT</field><field name="SHAPE">L</field><statement name="DO">
                     <block type="tp_repeat_option"><field name="REPEAT">UNTIL</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field>
                     <statement name="DO"><block type="transportpod_turn_right"></block></statement></block></statement></block></next></block></statement></block>
                     </next></block>
                  </xml>`
         }
      });
      //scale canvas to fit the screen
      $('#blocklyDivH2').find('.blocklyBlockCanvas').css('transform', 'scale(0.8)');

   },
   P1M318_P1H3: function () {

      this.initBasicActionItems({
         worlds: [{
            worldID: '#tp-world1-h318',
            state: $.extend(true, [], this.world318),
            map: this.map318,
            CURRENT_HEAD_DEG: 90,
            r_deg: 30,
            cellWidth: 30,
         }],
         tpConfig: {
            workspaceSettings: { readOnly: true },
            blocklyElem: 'blocklyDivH318',
            workspaceData:
               `<xml xmlns="http://www.w3.org/1999/xhtml">
                  <block type="when_run" deletable="false" movable="false" x="20" y="20"><next>
                  <block type="tp_repeat_option"><field name="REPEAT">UNTIL</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">F</field>
                  <statement name="DO"><block type="tp_repeat_option"><field name="REPEAT">WHILE</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field>
                  <statement name="DO"><block type="transportpod_move_pod"></block></statement><next>
                  <block type="tp_if_do"><field name="SENSOR">LEFT</field><field name="SHAPE">L</field><statement name="DO">
                  <block type="tp_repeat_option"><field name="REPEAT">UNTIL</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field>
                  <statement name="DO"><block type="transportpod_turn_left"></block></statement></block></statement></block></next></block></statement></block>
                  </next></block>
               </xml>`
         }
      });

   },
   P1M319: function () {
      this.initBasicActionItems({
         worlds: [{
            worldID: '#tp-world1',
            state: $.extend(true, [], this.world319),
            map: this.map319,
            cellWidth: 25,
         }],
         tpConfig: {
            toolboxData: this.getToolbox('tp_if_do'),
            workspaceSettings: {
               trashcan: true,
               scrollbars: true
            },
            workspaceData:
               `<xml xmlns="http://www.w3.org/1999/xhtml">
                  <block type="when_run" deletable="false" movable="false" x="20" y="20"><next><block type="tp_repeat_option">
                  <field name="REPEAT">UNTIL</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">S</field><statement name="DO">
                  <block type="tp_repeat_option"><field name="REPEAT">WHILE</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field>
                  <statement name="DO"><block type="transportpod_move_pod"></block></statement></block></statement></block></next></block>
               </xml>`
         }
      });
      this.helpTooltip();
   },
   P1M319_P1H2: function () {

      this.initBasicActionItems({
         tpConfig: {
            workspaceSettings: { readOnly: true },
            blocklyElem: 'blocklyDivH2',
            workspaceData:
               `<xml xmlns="http://www.w3.org/1999/xhtml"><block type="when_run" deletable="false" movable="false" x="20" y="20"><next>
                  <block type="tp_if_do"><field name="SENSOR"></field><field name="SHAPE"></field><statement name="DO">
                  <block type="robotarm_none"></block></statement><next><block type="tp_if_do"><field name="SENSOR"></field><field name="SHAPE"></field>
                  <statement name="DO"><block type="robotarm_none"></block></statement></block></next></block></next></block>
               </xml>`
         }
      });
      //remove the shadow for the empty block
      $('#blocklyDivH2 .blocklyPathDark').css("fill", "#ffffff");
   },
   P1M319_P1H3: function () {

      this.initBasicActionItems({
         worlds: [{
            worldID: '#tp-world1-h319',
            state: $.extend(true, [], this.world319),
            map: this.map319,
            cellWidth: 25,
         }],
         tpConfig: {
            workspaceSettings: { readOnly: true },
            blocklyElem: 'blocklyDivH319',
            workspaceData:
               `<xml xmlns="http://www.w3.org/1999/xhtml"><block type="when_run" deletable="false" movable="false" x="20" y="20"><next>
                     <block type="tp_repeat_option"><field name="REPEAT">UNTIL</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">S</field>
                     <statement name="DO"><block type="tp_repeat_option"><field name="REPEAT">WHILE</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field><statement name="DO">
                     <block type="transportpod_move_pod"></block></statement><next><block type="tp_if_do"><field name="SENSOR">LEFT</field><field name="SHAPE">L</field>
                     <statement name="DO"><block type="tp_repeat_option"><field name="REPEAT">UNTIL</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field>
                     <statement name="DO"><block type="transportpod_turn_left"></block></statement></block></statement><next>
                     <block type="tp_if_do"><field name="SENSOR">RIGHT</field><field name="SHAPE">L</field><statement name="DO">
                     <block type="tp_repeat_option"><field name="REPEAT">UNTIL</field><field name="SENSOR">MIDDLE</field><field name="SHAPE">L</field><statement name="DO">
                     <block type="transportpod_turn_right"></block></statement></block></statement></block></next></block></next></block></statement></block></next></block>
                  </xml>`
         }
      });

      //scale canvas to fit the screen
      $('#blocklyDivH319').find('.blocklyBlockCanvas').css('transform', 'scale(0.8)');
   },
   P1M322: function () {
      this.helpTooltip();
      //replace help screen 1 content
      $('.lc-help').addClass('g-hide');
      $('.bc-help').removeClass('g-hide');
   },
   P1M323: function () {
      this.initBasicActionItems({
         worlds: [{
            worldID: '#tp-world1',
            state: $.extend(true, [], this.world323),
            CURRENT_HEAD_DEG: 0,
            map: this.map323,
            cellWidth: 30,
            width: 520
         }],
         tpConfig: {
            toolboxData: this.getToolbox('all'),
            workspaceSettings: {
               trashcan: true,
               scrollbars: true
            },
            workspaceData:
               `<xml xmlns="http://www.w3.org/1999/xhtml">
               <block type="when_run" x="20" y="20" movable="false"></block>
            </xml>`
         }
      });
      this.helpTooltip();
   },
   P1M323_P1H: function () {

      this.initBasicActionItems({
         tpConfig: {
            workspaceSettings: { readOnly: true },
            blocklyElem: 'blocklyDivH2',
            workspaceData:
               `<xml xmlns="https://developers.google.com/blockly/xml"><block type="when_run" deletable="false" movable="false" x="20" y="20"><next>
                  <block type="tp_repeat_option"><field name="REPEAT">UNTIL</field><field name="SENSOR"></field><field name="SHAPE"></field><statement name="DO">
                  <block type="tp_repeat_option"><field name="REPEAT">WHILE</field><field name="SENSOR"></field><field name="SHAPE"></field><statement name="DO">
                  <block type="robotarm_none"></block></statement><next><block type="tp_if_do"><field name="SENSOR"></field><field name="SHAPE"></field>
                  <statement name="DO"><block type="robotarm_none"></block></statement><next>
                  <block type="tp_if_do"><field name="SENSOR"></field><field name="SHAPE"></field><statement name="DO">
                  <block type="robotarm_none"></block></statement><next><block type="tp_if_do"><field name="SENSOR"></field><field name="SHAPE"></field>
                  <statement name="DO"><block type="robotarm_none"></block></statement></block></next></block></next></block></next>
                  </block></statement></block></next></block>
               </xml>`
         }
      });
      //remove the shadow for the empty block
      $('#blocklyDivH2 .blocklyPathDark').css("fill", "#ffffff");
   },
   initBasicActionItems: function (config) {
      let maxAttempts = parseInt($('#task').data('max-attempts')),
         maxActions = parseInt($('#task').data('max-actions')),
         answerStep = -1,
         me = this,
         tp = null;
      // setup the worlds
      $.each(config.worlds, function () {
         // console.log(new Sonet.am.widgets.TranportPodWorld($(this.worldID), this))
         $(this.worldID).data("object", new Sonet.am.widgets.TranportPodWorld($(this.worldID), this));
      })

      if (config.tpConfig != null) {

         tp = new Sonet.am.widgets.RoboArmBlocklyPlugin(config.tpConfig);
         //check if is for help screen
         var blocklyID = config.tpConfig.blocklyElem;

         if (blocklyID !== undefined && blocklyID.substr(0, 11) == 'blocklyDivH') {
            var currentTask = blocklyID.split("H")[1];

            $(".g-btn-blockly-run-h" + currentTask).on('click', function () {
               var target = $('.g-blockly-target-h' + currentTask);
               me.parent.runBlocklyProgram('.g-btn-blockly-run-h' + currentTask, tp, target, answerStep);
            });

         } else {
            $(".g-btn-blockly-run").on('click', function () {
               var target = $('.g-blockly-target');
               me.parent.runBlocklyProgram('.g-btn-blockly-main', tp, target, answerStep);
            });
         }

         $(".g-btn-blockly-undo").on('click', function () {
            data = {
               "event_type": 'undo',
               "event_location": null,
               "event_prev": null,
               "event_result": null
            };
            if (parseInt($('#blocksCount').html()) > 1) {
               // console.log($("#blocklyDiv").html())
               // console.log($(".blocklyWorkspace").children().first().next().next().html());
               // $(".blocklyWorkspace").children().first().next().next().attr("transform", "translate(200, 0)")
               me.parent.saveEvents(data);
               tp.blocklyWorkspace.undo(false);
            }

         });
         $(".g-btn-blockly-redo").on('click', function () {
            data = {
               "event_type": 'redo',
               "event_location": null,
               "event_prev": null,
               "event_result": null
            };
            $("#blocklyDiv").html();
            // $(".blocklySelected").attr("transform", "rotate(10)")
            me.parent.saveEvents(data);
            tp.blocklyWorkspace.undo(true);
         });

         config.tp = tp;
         // allow speed changes
         $(".g-blockly-speed").change(function () {
            let speed = this.value * -1 + 1;
            tp.setSpeed(speed / 5);
            $('.p1-m3-world').each(function () {
               if ($(this).data('object')) {
                  $(this).data('object').setSpeed(speed * 10);
               }
            });
            data = {
               "event_type": 'speed',
               "event_location": null,
               "event_prev": this.defaultValue,
               "event_result": this.value
            };
            me.parent.saveEvents(data);
         });
      }

      // if we have an answer use the last answer as the end state if we want to show the answer to the student
      if (config['answerXML'] != null && config['endWorkspace'] == null) {
         config.endWorkspace = me.convertAnswerToWorkspaceXml(config.answerXML[config.answerXML.length - 1]);
      }

      // set a default callback to check the answer if we have set answers
      if (config['answerXML'] != null && config['checkAnsCb'] == null) {
         // compare the current xml with the answer we are up-to, support multi-step answers
         config.checkAnsCb = function (sBlock, step = null) {
            return config.tp.isXmlEqual(config.answerXML[step != null ? step : config.answerXML.length - 1], sBlock);
         };
      }

      // force the student through the right answers
      let nextAnswerStep = function () {
         answerStep++;
         $(config.answer[answerStep]).removeAttr("disabled").addClass('g-blockly-correct');
      };

      if ($('#task').hasClass('p1-check-blockly')) {
         $('#task').on('checkFinish', function (e) {
            let sBlock = tp.blocklyWorkspace.getBlocksByType('when_run')[0];
            if (!me.parent.isModalShowing('.g-success-dialog') && !me.parent.isModalShowing('.g-retry-dialog')) {
               e.dialog[0] = config.checkAnsCb(sBlock) ? 'g-success-dialog' : 'g-retry-dialog';
            }
         });
      }

      if ($('#task').hasClass('p1-check-efficiency')) {
         $('#task').on('checkFinish', function (e) {
            if (parseInt($('#blocksCount').html()) > parseInt($('#task').data('blocks'))) {
               e.dialog[0] = 'g-efficiency-dialog';
            }
         });
      }

      $('.g-btn-blockly-block').on("click", function () {
         // prevent additional clicks until done
         $('.g-btn-blockly').attr("disabled", true).removeClass('g-blockly-correct');
         maxActions--;

         // run the action
         let p = $('.g-blockly-target').data('object').performAction($(this).data('action'));

         // if the promise is null we error'd
         if (p == null) {
            Sonet.Util.showModal('g-retry-dialog');
         }

      });

   },
   convertAnswerToWorkspaceXml: function (answerXml) {
      return '<xml xmlns="http://www.w3.org/1999/xhtml">' + answerXml.replace('xmlns="https://developers.google.com/blockly/xml"', 'x="20" y="20"') + '</xml>';
   },
   saveResults: function () {
      $('.g-blockly').each(function () {
         if ($(this).data('obj')) {
            $(this).data('obj').saveResults();
         }
      });
   },
   getToolbox: function (types) {
      let content = [];
      //for all toolbox
      content.push('transportpod_move_pod', 'transportpod_turn_left', 'transportpod_turn_right');

      if (types == 'basic') {

      } else if (types == 'all') {
         content.push('tp_wait', 'tp_if_do', 'repeat_do');
      } else {
         content = content.concat(types);
      }

      content.push('tp_repeat_option');

      for (let i = 0; i < content.length; i++) {
         if (typeof content[i] !== 'object') {
            content[i] = {
               "kind": "block",
               "type": content[i]
            }
         }
      }

      return {
         "kind": "flyoutToolbox",
         "contents": content
      };
   },
   helpTooltip: function () {
      // show hide the tooltip for page3 depending on whether we are on that page
      $('.g-help-page3').on('show', function () {
         $('.p1-m3-help-b1').removeClass('g-hide');
      }).on('hide', function () {
         $('.p1-m3-help-b1').addClass('g-hide');
      });
   },

   switchTutorial: function (target) {
      me = this;
      //save event data
      data = {
         "event_type": 'tutorial',
         "event_location": null,
         "event_prev": null,
         "event_result": target
      };
      me.parent.saveEvents(data);

      let currentWindow = $('.g-tutorial-text div[data-target=' + target + ']');

      //switch text content
      $('.g-tutorial-window-card-text span').html(currentWindow.html());
      //update window data target
      $('.g-tutorial-window-content').attr('data-current-page', target);
      //update window position
      $('.g-tutorial-window').css({ 'top': currentWindow.attr("data-position-top") + 'px', '--xpos': currentWindow.attr("data-position-xpos") + 'px' });
      //update triangle position
      $('[class$="-tri-group"]').addClass("g-hide");
      $('.g-tutorial-window-' + currentWindow.attr("data-triangle-position") + '-tri-group ').removeClass("g-hide");

      if (target == 'finish') {
         $('.g-tutorial-window-normal,.g-tutorial-window-warning').addClass("g-hide");
         console.log("finished:")
         Sonet.Util.showModal('g-tutorial-finished');
         $('#task').removeClass('p1-check-finish');
      } else if ($.isNumeric(target)) {
         //update dot style
         $('.g-tutorial-processing-dot-current').removeClass('g-tutorial-processing-dot-current').addClass('g-tutorial-processing-dot-inactive');
         $('.g-tutorial-processing-dot:nth-child(' + target + ')').removeClass('g-tutorial-processing-dot-inactive').addClass('g-tutorial-processing-dot-current');

         if (target === '2' && $("#task").attr("data-itemid") == "P1M309") {
            $('.g-tutorial-window-tri').addClass('g-tutorial-window-left-tri-top');
         } else {
            $('.g-tutorial-window-tri').removeClass('g-tutorial-window-left-tri-top');
         }
      }
   },

   renderTutorialMainWindow: function (target) {
      let tutorialMainWindow = "";
      switch (target) {
         case 0:
            tutorialMainWindow = `<div class="g-flex-center-row g-full-height">
               <div class="p1-m3-pod-img border relative">
                  <p class="text-18 mt-0 text-bold-7">Side view</p>
                  <div class="flex mt-130 flex-column align-center">
                     <p class="m-0 absolute text-red text-16 text-bold-5 text-side-front">front of nature pod</p>
                     <p class="m-0 absolute text-red text-16 text-bold-5 text-side-back">back of nature pod</p>
                     <p class="m-0 absolute text-16 text-bold-5 text-side-sensor">colour sensor</p>
                     <div class="angle-anti-67 length-65 absolute arrow-side-sensor"><span class="arrow"></span></div>
                     <p class="m-0 absolute text-16 text-bold-5 text-side-wheel">wheel</p>
                     <div class="angle-anti-160 length-93 absolute arrow-side-wheel"><span class="arrow"></span></div>
                     <img src="images/pod-side-note.png" />
                  </div>
               </div>
               <div class="p1-m3-pod-img border relative">
                  <p class="text-18 mt-0 text-bold-7">Top-down view</p>
                  <p class="text-red text-18 text-center text-bold-5">front of nature pod</p>
                  <div class="text-center w-full right-image">
                     <p class="m-0 absolute text-16 text-bold-5 text-middle-sensor">middle colour sensor</p>
                     <p class="m-0 absolute text-16 text-bold-5 text-left-sensor">left colour sensor</p>
                     <p class="m-0 absolute text-16 text-bold-5 text-right-sensor">right colour sensor</p>
                     <p class="m-0 absolute text-16 text-bold-5 text-left-wheel">left wheel</p>
                     <p class="m-0 absolute text-16 text-bold-5 text-right-wheel">right wheel</p>
                     <div class="angle-90 length-140 absolute arrow-middle-sensor"><span class="arrow"></span></div>
                     <div class="angle-45 length-70 absolute arrow-left-sensor"><span class="arrow"></span></div>
                     <div class="angle-135 length-70 absolute arrow-right-sensor"><span class="arrow"></span></div>
                     <div class="length-80 absolute arrow-left-wheel"><span class="arrow"></span></div>
                     <div class="angle-180 length-80 absolute arrow-right-wheel"><span class="arrow"></span></div>
                     <img src="images/pod-top-note.png" />
                  </div>
                  <p class="text-red text-18 text-center text-bold-5">back of Nature Pod</p>
               </div>
            </div>`;
            $("#p1-m3-09-tutorial-main-window").html(tutorialMainWindow);
            break;
         case 1:
         case 2:
            tutorialMainWindow = `<div class="hole"></div>
            <div class="g-full-height background-white mt-19">
               <div class="p1-m3-pod-img relative border-transparent mt-10">
                  <p class="text-18 mt-0 text-bold-7">Top-down view of Nature Pod</p>
                  <p class="text-red text-18 text-center text-bold-5">front of nature pod</p>
                  <div class="text-center w-full detail-image">
                     <p class="m-0 absolute text-16 text-bold-5 text-middle-sensor-detail">middle colour sensor</p>
                     <p class="m-0 absolute text-16 text-bold-5 text-left-sensor-detail">left colour sensor</p>
                     <p class="m-0 absolute text-16 text-bold-5 text-right-sensor-detail">right colour sensor</p>
                     <p class="m-0 absolute text-16 text-bold-5 text-left-wheel-detail">left wheel</p>
                     <p class="m-0 absolute text-16 text-bold-5 text-right-wheel-detail">right wheel</p>
                     <div class="angle-90 length-65 absolute arrow-middle-sensor-detail"><span class="arrow"></span>
                     </div>
                     <div class="angle-90 length-40 absolute arrow-left-sensor-detail"><span class="arrow"></span></div>
                     <div class="angle-90 length-40 absolute arrow-right-sensor-detail"><span class="arrow"></span>
                     </div>
                     <div class="angle-anti-60 length-100 absolute arrow-left-wheel-detail"><span class="arrow"></span>
                     </div>
                     <div class="angle-anti-118 length-100 absolute arrow-right-wheel-detail"><span
                           class="arrow"></span>
                     </div>
                     <img class="zoom-image ml-60" src="images/pod-top-note.png" />
                  </div>
                  <p class="text-red text-18 text-center text-bold-5 mt-35">back of Nature Pod</p>
               </div>
            </div>`;
            $("#p1-m3-09-tutorial-main-window").html(tutorialMainWindow);
            break;
         case 3:
            tutorialMainWindow = `<div class="height-full background-white mt-19">
               <div class="p1-m3-pod-img relative border-transparent">
                  <p class="text-18 text-bold-7">Close-up view of Nature Pod</p>
                  <div class="text-center w-full mt-70">
                     <img src="images/pod-track.png" usemap="#workmap"/>
                  </div>
               </div>
            </div>`;
            $("#p1-m3-09-tutorial-main-window").html(tutorialMainWindow);
            break;
         case 4:
            tutorialMainWindow = `<div class="cover-right absolute"></div><map name="workmap"><area id="click-sensor" shape="circle" coords="250,100,50" class="click-sensor"></map>`;
            $("#p1-m3-09-tutorial-main-window").prepend(tutorialMainWindow);
            break;
         case "finish":
            $(".cover-right").remove();
            $("#p1-m3-09-tutorial-main-window .p1-m3-pod-img").prepend(`<div class="absolute"><svg height="500" width="500">
            <ellipse cx="273" cy="228" rx="33" ry="37" class="svg-ellipse" />
          </svg></div>`)
            break;
         default:
            break;
      }
   },
   renderTutorialWindow: function (
      renderElementId,
      configGroup,
      actionRequiredList,
      isWarning = false,
      finishModalClass = ""
   ) {
      // console.log(renderElementId, configGroup, actionRequiredList)
      let me = this;
      let renderElementIdClompleted = "#" + renderElementId;

      let getWindowIndex = windowIndex => Number(windowIndex) + 1;

      let config =
         typeof configGroup.normal.filter((item) => item.isCurrent)[0] !==
            "undefined"
            ? configGroup.normal.filter((item) => item.isCurrent)[0]
            : configGroup.normal[0];

      let dotGroupHtml = "";
      let currentTutorialIndex = configGroup.normal.indexOf(config);
      let tutorialText = "";

      config.tutorialText.forEach(element => {
         tutorialText = tutorialText + `<div class="g-tutorial-window-card-text g-tutorial-modal-text"> ${element}</div>`;

      });

      for (let i = 0; i < configGroup.normal.length; i++)
         dotGroupHtml +=
            currentTutorialIndex === i
               ? `<div class="g-tutorial-processing-dot g-tutorial-processing-dot-current"></div>`
               : `<div class="g-tutorial-processing-dot g-tutorial-processing-dot-inactive"></div>`;

      let tutorialHtml = ` <div class="g-tutorial-window g-tutorial-window-${isWarning ? "warning" : "normal"
         } g-rtl-left-pos" style="${typeof config.position.top !== "undefined"
            ? "top: " + config.position.top + "px;"
            : ""
         } 
       ${typeof config.position.xpos !== "undefined"
            ? "--xpos: " + config.position.xpos + "px;"
            : ""
         }
       ">
       <i class="g-tutorial-window-info fas fa-info-circle g-rtl-left-pos ${isWarning ? '' : 'g-hide'
         }"></i>
 
       <span class="g-tutorial-window-top-right-tri-group${config.trianglePosition === "topRight" ? '' : ' g-hide'
         }">
          <span class="g-tutorial-window-tri g-tutorial-window-top-right-tri g-rtl-left-pos"></span>
          <span class="g-tutorial-window-tri g-tutorial-window-top-right-tri g-tutorial-window-top-tri-border  g-rtl-left-pos"></span>
       </span>
       <span class="g-tutorial-window-top-left-tri-group${config.trianglePosition === "topLeft" ? '' : ' g-hide'
         }">
          <span class="g-tutorial-window-tri g-tutorial-window-top-left-tri g-tutorial-window-top-tri-cover g-rtl-left-pos"></span>
          <span class="g-tutorial-window-tri g-tutorial-window-top-left-tri g-tutorial-window-top-tri-border g-rtl-left-pos"></span>
       </span>
       <span class="g-tutorial-window-left-tri-group${config.trianglePosition === "left" ? '' : ' g-hide'
         }">
          <span class="g-tutorial-window-tri g-tutorial-window-left-tri g-rtl-left-pos g-tutorial-window-left-tri-border"></span>
          
          <span class="g-tutorial-window-tri g-tutorial-window-left-tri g-tutorial-window-left-tri-cover g-rtl-left-pos"></span>
       </span>
       <span class="g-tutorial-window-right-tri-group${config.trianglePosition === "right" ? '' : ' g-hide'
         }">
          <span class="g-tutorial-window-tri g-tutorial-window-right-tri g-rtl-right-pos g-tutorial-window-right-tri-cover"></span>
          <span class="g-tutorial-window-tri g-tutorial-window-right-tri g-tutorial-window-right-tri-border g-rtl-right-pos"></span>
       </span>
       <span class="g-tutorial-window-bottom-right-tri-group${config.trianglePosition === "bottomRight" ? '' : ' g-hide'
         }">
          <span class="g-tutorial-window-tri g-tutorial-window-bottom-right-tri g-rtl-left-pos"></span>
          <span class="g-tutorial-window-tri g-tutorial-window-bottom-right-tri g-tutorial-window-bottom-right-tri-border  g-rtl-left-pos"></span>
       </span>
 
       <div class="g-tutorial-window-content" data-current-page=${config.dataTarget !== undefined ? "'" + config.dataTarget + "'" : ''}>
          <div class="g-tutorial-window-card">${renderElementId.indexOf("p1-m3") > -1 ?
            "<img class='g-avatar-img g-avatar-large g-rtl-img' src='images/pod-avatar.png' />" :
            "<img class='g-avatar-img g-rtl-img g-avatar-medium' src='images/fitness-avatar.png' />"}
             <div class="g-tutorial-window-card-text g-tutorial-modal-text">
             ${tutorialText}
             </div>
          </div>
 
          <div class="g-tutorial-window-buttom-group">

             <div class="g-tutorial-window-back-button">Back</div>
 
             <div class="g-tutorial-dots-holder">${dotGroupHtml}</div>
 
             <button class="g-btn  g-tutorial-window-next-button g-tutorial-window-next-button-${configGroup.normal.indexOf(
               config
            )}"><span data-am-translate="p1.tutorial.window.forward" data-wysiwyg="false" data-am-translate-group="p1.tutorial.window">Forward</span></button>
 
          </div>
 
       </div>
    </div>`;

      $(renderElementIdClompleted).html(tutorialHtml);
   },

}
